openapi: '3.0.0'
info:
  version: 1.0.0
  title: Social Agro API
  description: API para gerenciamento de animais, produção de leite e usuários no contexto agrícola
  contact:
    name: Carlos Emannoel dos Santos Carneiro
    email: suporte@socialagro.com

servers:
  - url: http://localhost:3000
    description: Servidor de Desenvolvimento
  - url: https://api.socialagro.com
    description: Servidor de Produção

tags:
  - name: Authentication
    description: Endpoints de autenticação e registro
  - name: User
    description: Gerenciamento de usuários
  - name: Animal
    description: Gerenciamento de animais
  - name: Milk Production
    description: Gerenciamento de produção de leite
  - name: Weight
    description: Gerenciamento de peso dos animais
  - name: Milk Price
    description: Gerenciamento de preços do leite
  - name: Dashboard
    description: Dashboard e estatísticas

paths:
  # ==================== AUTHENTICATION ====================
  /auth:
    post:
      tags:
        - Authentication
      summary: Autenticação de usuário
      description: Realiza o login do usuário e retorna um token JWT
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                  example: 'usuario@exemplo.com'
                password:
                  type: string
                  format: password
                  example: 'senha123'
              required:
                - email
                - password
      responses:
        200:
          description: Login realizado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: Token JWT para autenticação
                  user:
                    $ref: '#/components/schemas/User'
        401:
          description: Credenciais inválidas
        500:
          description: Erro interno do servidor

  /user/register:
    post:
      tags:
        - Authentication
      summary: Registro de novo usuário
      description: Cria uma nova conta de usuário no sistema
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRegister'
      responses:
        201:
          description: Usuário criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
        400:
          description: Dados inválidos
        409:
          description: Email já cadastrado
        500:
          description: Erro interno do servidor

  # ==================== USER ====================
  /user/{id}:
    get:
      tags:
        - User
      summary: Buscar usuário por ID
      description: Retorna os dados de um usuário específico
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID do usuário
      responses:
        200:
          description: Usuário encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        404:
          description: Usuário não encontrado
        401:
          description: Não autorizado

  /user:
    put:
      tags:
        - User
      summary: Atualizar usuário
      description: Atualiza os dados do usuário autenticado
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                file:
                  type: string
                  format: binary
                  description: Foto de perfil do usuário
      responses:
        200:
          description: Usuário atualizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        400:
          description: Dados inválidos
        401:
          description: Não autorizado

  # ==================== ANIMAL ====================
  /animal:
    post:
      tags:
        - Animal
      summary: Criar novo animal
      description: Registra um novo animal no sistema
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/AnimalCreate'
      responses:
        201:
          description: Animal criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Animal'
        400:
          description: Dados inválidos
        401:
          description: Não autorizado
    put:
      tags:
        - Animal
      summary: Atualizar animal
      description: Atualiza os dados de um animal existente
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              allOf:
                - $ref: '#/components/schemas/AnimalCreate'
                - type: object
                  properties:
                    id:
                      type: string
                      description: ID do animal a ser atualizado
                  required:
                    - id
      responses:
        200:
          description: Animal atualizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Animal'
        400:
          description: Dados inválidos
        404:
          description: Animal não encontrado
        401:
          description: Não autorizado

  /animal/all:
    get:
      tags:
        - Animal
      summary: Listar todos os animais
      description: Retorna todos os animais do usuário autenticado
      security:
        - bearerAuth: []
      responses:
        200:
          description: Lista de animais retornada com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Animal'
        401:
          description: Não autorizado

  /animal/{id}:
    get:
      tags:
        - Animal
      summary: Buscar animal por ID
      description: Retorna os detalhes de um animal específico
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID do animal
      responses:
        200:
          description: Animal encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Animal'
        404:
          description: Animal não encontrado
        401:
          description: Não autorizado
    delete:
      tags:
        - Animal
      summary: Deletar animal
      description: Remove um animal do sistema
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID do animal
      responses:
        200:
          description: Animal deletado com sucesso
        404:
          description: Animal não encontrado
        401:
          description: Não autorizado

  /animal/search/{params}:
    get:
      tags:
        - Animal
      summary: Buscar animais
      description: Busca animais por parâmetros (nome, raça, etc)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: params
          required: true
          schema:
            type: string
          description: Parâmetros de busca
      responses:
        200:
          description: Resultado da busca
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Animal'
        401:
          description: Não autorizado

  # ==================== MILK PRODUCTION ====================
  /milk-production/add:
    post:
      tags:
        - Milk Production
      summary: Adicionar produção de leite
      description: Registra uma nova produção de leite para um animal
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MilkProductionCreate'
      responses:
        201:
          description: Produção de leite adicionada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MilkProduction'
        400:
          description: Dados inválidos
        401:
          description: Não autorizado

  /milk-production:
    put:
      tags:
        - Milk Production
      summary: Atualizar produção de leite
      description: Atualiza um registro de produção de leite existente
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/MilkProductionCreate'
                - type: object
                  properties:
                    id:
                      type: string
                      description: ID da produção de leite
                  required:
                    - id
      responses:
        200:
          description: Produção de leite atualizada com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MilkProduction'
        400:
          description: Dados inválidos
        404:
          description: Produção não encontrada
        401:
          description: Não autorizado

  /milk-production/{id}:
    get:
      tags:
        - Milk Production
      summary: Buscar produção de leite por ID
      description: Retorna os detalhes de uma produção de leite específica
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID da produção de leite
      responses:
        200:
          description: Produção encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MilkProduction'
        404:
          description: Produção não encontrada
        401:
          description: Não autorizado
    delete:
      tags:
        - Milk Production
      summary: Deletar produção de leite
      description: Remove um registro de produção de leite
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID da produção de leite
      responses:
        200:
          description: Produção deletada com sucesso
        404:
          description: Produção não encontrada
        401:
          description: Não autorizado

  # ==================== WEIGHT ====================
  /animal/weight/add:
    post:
      tags:
        - Weight
      summary: Adicionar peso do animal
      description: Registra um novo peso para um animal
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WeightCreate'
      responses:
        201:
          description: Peso adicionado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Weight'
        400:
          description: Dados inválidos
        401:
          description: Não autorizado

  /animal/weight/{id}:
    get:
      tags:
        - Weight
      summary: Buscar peso por ID
      description: Retorna os detalhes de um registro de peso
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID do registro de peso
      responses:
        200:
          description: Peso encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Weight'
        404:
          description: Peso não encontrado
        401:
          description: Não autorizado
    put:
      tags:
        - Weight
      summary: Atualizar peso do animal
      description: Atualiza um registro de peso existente
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID do registro de peso
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WeightCreate'
      responses:
        200:
          description: Peso atualizado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Weight'
        400:
          description: Dados inválidos
        404:
          description: Peso não encontrado
        401:
          description: Não autorizado
    delete:
      tags:
        - Weight
      summary: Deletar peso do animal
      description: Remove um registro de peso
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: ID do registro de peso
      responses:
        200:
          description: Peso deletado com sucesso
        404:
          description: Peso não encontrado
        401:
          description: Não autorizado

  # ==================== MILK PRICE ====================
  /milk/price:
    get:
      tags:
        - Milk Price
      summary: Listar todos os preços do leite
      description: Retorna histórico de preços do leite
      security:
        - bearerAuth: []
      responses:
        200:
          description: Lista de preços retornada com sucesso
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MilkPrice'
        401:
          description: Não autorizado
    post:
      tags:
        - Milk Price
      summary: Criar novo preço do leite
      description: Registra um novo preço do leite
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MilkPriceCreate'
      responses:
        201:
          description: Preço criado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MilkPrice'
        400:
          description: Dados inválidos
        401:
          description: Não autorizado

  /milk/price/last:
    get:
      tags:
        - Milk Price
      summary: Buscar último preço do leite
      description: Retorna o preço mais recente do leite
      security:
        - bearerAuth: []
      responses:
        200:
          description: Último preço retornado com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MilkPrice'
        404:
          description: Nenhum preço encontrado
        401:
          description: Não autorizado

  # ==================== DASHBOARD ====================
  /dashboard:
    get:
      tags:
        - Dashboard
      summary: Dados do dashboard
      description: Retorna estatísticas e dados para o dashboard inicial
      security:
        - bearerAuth: []
      responses:
        200:
          description: Dados do dashboard retornados com sucesso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Dashboard'
        401:
          description: Não autorizado

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Token JWT para autenticação. Use o formato "Bearer {token}"

  schemas:
    # ==================== USER SCHEMAS ====================
    User:
      type: object
      properties:
        id:
          type: string
          description: ID único do usuário
        name:
          type: string
          description: Nome completo do usuário
        email:
          type: string
          format: email
          description: Email do usuário
        avatar:
          type: string
          description: URL da foto de perfil
        createdAt:
          type: string
          format: date-time
          description: Data de criação da conta
        updatedAt:
          type: string
          format: date-time
          description: Data da última atualização

    UserRegister:
      type: object
      properties:
        name:
          type: string
          example: 'João Silva'
        email:
          type: string
          format: email
          example: 'joao@exemplo.com'
        password:
          type: string
          format: password
          example: 'senha123'
        confirmPassword:
          type: string
          format: password
          example: 'senha123'
      required:
        - name
        - email
        - password
        - confirmPassword

    # ==================== ANIMAL SCHEMAS ====================
    Animal:
      type: object
      properties:
        id:
          type: string
          description: ID único do animal
        surname:
          type: string
          description: Apelido do animal
        dateOfBirth:
          type: string
          format: date
          description: Data de nascimento
        breed:
          type: string
          description: Raça do animal
        gender:
          type: string
          enum: [male, female]
          description: Gênero do animal
        weight:
          type: number
          description: Peso atual em kg
        ownerId:
          type: string
          description: ID do proprietário
        fatherId:
          type: string
          description: ID do pai
        motherId:
          type: string
          description: ID da mãe
        imageUrl:
          type: string
          description: URL da imagem do animal
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AnimalCreate:
      type: object
      properties:
        surname:
          type: string
          description: Apelido do animal
          example: 'Mimosa'
        dateOfBirth:
          type: string
          format: date
          description: Data de nascimento
          example: '2020-05-15'
        breed:
          type: string
          description: Raça do animal
          example: 'Holandês'
        fatherId:
          type: string
          description: ID do pai do animal
        motherId:
          type: string
          description: ID da mãe do animal
        ownerId:
          type: string
          description: ID do proprietário
        gender:
          type: string
          enum: [male, female]
          description: Gênero do animal
          example: 'female'
        weight:
          type: number
          description: Peso inicial em kg
          example: 450.5
        file:
          type: string
          format: binary
          description: Imagem do animal
      required:
        - surname
        - dateOfBirth
        - ownerId
        - gender

    # ==================== MILK PRODUCTION SCHEMAS ====================
    MilkProduction:
      type: object
      properties:
        id:
          type: string
          description: ID único da produção
        animalId:
          type: string
          description: ID do animal
        quantity:
          type: number
          description: Quantidade em litros
        date:
          type: string
          format: date
          description: Data da produção
        period:
          type: string
          enum: [morning, afternoon, evening]
          description: Período do dia
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    MilkProductionCreate:
      type: object
      properties:
        animalId:
          type: string
          description: ID do animal
          example: '123e4567-e89b-12d3-a456-426614174000'
        quantity:
          type: number
          description: Quantidade produzida em litros
          example: 15.5
        date:
          type: string
          format: date
          description: Data da produção
          example: '2024-11-06'
        period:
          type: string
          enum: [morning, afternoon, evening]
          description: Período do dia
          example: 'morning'
      required:
        - animalId
        - quantity
        - date
        - period

    # ==================== WEIGHT SCHEMAS ====================
    Weight:
      type: object
      properties:
        id:
          type: string
          description: ID único do registro de peso
        animalId:
          type: string
          description: ID do animal
        weight:
          type: number
          description: Peso em kg
        date:
          type: string
          format: date
          description: Data da pesagem
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    WeightCreate:
      type: object
      properties:
        animalId:
          type: string
          description: ID do animal
          example: '123e4567-e89b-12d3-a456-426614174000'
        weight:
          type: number
          description: Peso em kg
          example: 485.5
        date:
          type: string
          format: date
          description: Data da pesagem
          example: '2024-11-06'
      required:
        - animalId
        - weight
        - date

    # ==================== MILK PRICE SCHEMAS ====================
    MilkPrice:
      type: object
      properties:
        id:
          type: string
          description: ID único do preço
        price:
          type: number
          description: Preço por litro
        date:
          type: string
          format: date
          description: Data de vigência do preço
        region:
          type: string
          description: Região aplicável
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    MilkPriceCreate:
      type: object
      properties:
        price:
          type: number
          description: Preço por litro
          example: 2.50
        date:
          type: string
          format: date
          description: Data de vigência
          example: '2024-11-06'
        region:
          type: string
          description: Região aplicável
          example: 'Sul'
      required:
        - price
        - date

    # ==================== DASHBOARD SCHEMAS ====================
    Dashboard:
      type: object
      properties:
        totalAnimals:
          type: integer
          description: Total de animais cadastrados
        totalMilkProduction:
          type: number
          description: Produção total de leite
        averageWeight:
          type: number
          description: Peso médio dos animais
        lastMilkPrice:
          type: number
          description: Último preço do leite registrado
        recentAnimals:
          type: array
          items:
            $ref: '#/components/schemas/Animal'
          description: Animais recentemente cadastrados

    # ==================== ERROR SCHEMAS ====================
    Error:
      type: object
      properties:
        message:
          type: string
          description: Mensagem de erro
        statusCode:
          type: integer
          description: Código de status HTTP
        errors:
          type: array
          items:
            type: string
          description: Lista de erros detalhados
